---
title             : "Justify Your Alpha: A Primer on Two Practical Approaches"
shorttitle        : "Justify in Practice"
author: 
  - name          : "Maximilian Maier"
    affiliation   : "1"
    corresponding : no
  - name          : "Daniel Lakens"
    affiliation   : "2"
    corresponding : yes
    address       : "ATLAS 9.402, 5600 MB, Eindhoven, The Netherlands"
    email         : "D.Lakens@tue.nl"
affiliation:
  - id            : "1"
    institution   : "University of Amsterdam, The Netherlands"
  - id            : "2"
    institution   : "Eindhoven University of Technology, The Netherlands"
author_note: |
  All code used to create this manuscript is provided in an OSF repository at https://osf.io/h5e2q/. Daniel Lakens was funded by VIDI Grant 452-17-013 from the Netherlands Organisation for Scientific Research.
note              : \textcolor{gray}{This unpublished manuscript is submitted for peer review}
abstract: |
 The default use of an alpha level of 0.05 is sub-optimal for two reasons. First, decisions based on data can be made more efficiently by choosing an alpha level that minimizes the combined Type 1 and Type 2 error rate. Second, in studies with very high statistical power *p*-values lower than the alpha level can actually be support for the null hypothesis, instead of for the alternative hypothesis. Because it is difficult to abandon a bad practice without providing an alternative, this manuscript explains two approaches that can be used to justify your alpha. The first approach is based on the idea to either minimize or balance Type 1 and Type 2 error rates. The second approach lowers the alpha level as a function of the sample size. Software is provided to perform the required calculations. Both approaches have their limitations (e.g., the challenge of specifying relative costs and priors, or the slightly arbitrary nature of how the alpha level should decrease as the sample size increases) but they nevertheless provide a clear improvement compared to current practices. The use of alpha levels that have a better justification should improve statistical inferences and increase the efficiency of scientific research.
  
keywords          : "hypothesis testing, Type 1 error, Type 2 error, statistical power"
wordcount         : 4890 words
bibliography      : ["justify_alpha_in_practice.bib"]
figsintext        : yes
linenumbers       : no
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : no
mask              : no
class             : "jou, a4paper"
output            : papaja::apa6_pdf
header-includes   :
latex_engine      : xelatex
  - \usepackage[T1]{fontenc}
  - \usepackage{heuristica}
mainfont: heuristica #I could not resist picking this font for this paper 
#Max will check the tests 
#Daniel will work on Vignette


---
```{r load_packages, include=FALSE}
  if(!require(justifieR)){devtools::install_github("Lakens/justifieR")}
library(justifieR)
library(ggplot2)
library(pwr)
library(papaja)
```

TO ADD: SECTION ON HOW TO THINK ABOUT TYPE 1 and 2 COSTS. SECTION FROM BLOG ON HOW ALPHA IS LONG RUN AND .03 and .05 are NOT THAT DIFFERENT.


Researchers often rely on data to decide how to act. In a Neyman-Pearson approach to hypothesis testing [@neyman_problem_1933] studies are designed such that erroneous decisions that determine how we act are controlled in the long run at some desired maximum level. If resources were infinite we could collect enough data to make the chance of a wrong decision incredibly small. But resources are limited, which means that researchers need to decide how to choose the rate at which they are willing to make errors. After data is collected researchers can incorrectly act as if there is an effect when there is no true effect (a Type 1 error) or incorrectly act as if there is no effect when there is a true effect (a Type 2 error). Given the same amount of data, a reduction in the Type 1 error rate will increase the Type 2 error rate (and vice versa) . 

The question how error rates should be set in any study requires careful consideration of the relative costs of a Type 1 error or a Type 2 error. Regrettably researchers rarely provide such a justification, and predominantly use a Type 1 error rate of 5%. In the past the strong convention to use a 5% alpha level might have functioned as a de facto prespecification of the alpha level, which needs to be before the data is analyzed [@tunc_epistemic_2021]. Nowadays researchers can transparently preregister a statistical analysis plan in an online repository, which makes it possible to specify more appropriate but less conventional alpha levels. Even though it is possible to preregister non-conventional alpha levels, there is relatively little guidance on how to choose an alpha level for a study. This article explains why error rates need to be justified, and provides two practical approaches that can be used to justify the alpha level. In the first approach, the Type I and Type II error rates are balanced or minimized, and in the second approach the alpha level is lowered as a function of the sample size. 

# Why do we use a 5% alpha level and 80% power?

We might naively assume that when all researchers do something, there must be a good reason for such an established practice. An important step towards maturity as a scholar is the realization that this is not the case. Neither Fisher nor Neyman, two statistical giants largely responsible for the widespread reliance on hypothesis tests in the social sciences, recommended the universal use of any specific threshold. @fisher_design_1935 writes: "It is open to the experimenter to be more or less exacting in respect of the smallness of the probability he would require before he would be willing to admit that his observations have demonstrated a positive result." Similarly, @neyman_problem_1933 write: "From the point of view of mathematical theory all that we can do is to show how the risk of the errors may be controlled and minimized. The use of these statistical tools in any given case, in determining just how the balance should be struck, must be left to the investigator."

Even though in *theory* alpha levels should be justified, in *practice* researchers tend to imitate others. Fisher writes in 1926: "Personally, the writer prefers to set a low standard of significance at the 5 per cent point, and ignore entirely all results which fail to reach this level". This sentence is preceded by the statement "If one in twenty does not seem high enough odds, we may, if we prefer it, draw the line at one in fifty (the 2 percent point), or one in a hundred (the 1 percent point)." Indeed, in his examples Fisher often uses an alpha of 0.01. Nevertheless, researchers seem to have copied the value Fisher preferred, instead of his more important take-home message that the significance level should be set by the experimenter. The default use of an alpha level of 0.05 seems to originate from the early work of Gosset on the *t*-distribution [@cowles_origins_1982; @kennedy-shaffer_before_2019], who believed that a difference of two standard deviations (a z-score of 2) was sufficiently rare.

The default use of 80% power (or a 20% Type 2, or beta (b) error) is similarly based on personal preferences by @cohen_statistical_1988, who writes: "It is proposed here as a convention that, when the investigator has no other basis for setting the desired power value, the value .80 be used. This means that beta is set at .20. This arbitrary but reasonable value is offered for several reasons (Cohen, 1965, pp. 98-99). The chief among them takes into consideration the implicit convention for alpha of .05. The beta of .20 is chosen with the idea that the general relative seriousness of these two kinds of errors is of the order of .20/.05, i.e., that Type I errors are of the order of four times as serious as Type II errors. This .80 desired power convention is offered with the hope that it will be ignored whenever an investigator can find a basis in his substantive concerns in his specific research investigation to choose a value ad hoc."

We see that conventions are built on conventions: the norm to aim for 80% power is built on the norm to set the alpha level at 5%. However, the real lesson Cohen was teaching us is to determine the relative seriousness of Type 1 and Type 2 errors, and to balance both types of errors when a study is designed. If a Type 1 error is considered to be four times as serious as a Type 2 error, the *weighted* error rates in the study are balanced. Instead of imitating the values chosen by Cohen, researchers should aim to imitate the approach he used to justify error rates.

## Justifying the alpha level

In 1957 Neyman wrote: "it appears desirable to determine the level of significance in accordance with quite a few circumstances that vary from one particular problem to the next." The mindless application of null hypothesis significance tests, including setting the alpha level at 5% for all tests, has been criticized for more than half a century [@bakan_test_1966; @gigerenzer_statistical_2018]. But it is difficult to abandon a mediocre research practice without an alternative.

There are two main reasons to abandon the universal use of a 5% alpha level. The first reason to carefully choose an alpha level is that decision making becomes more efficient. If researchers use hypothesis tests to make dichotomous decisions from a methodological falsificationist approach to statistical inferences [@tunc_epistemic_2021], it is typically possible to make decisions more efficiently, where the combined Type 1 and Type 2 error rate is minimized, by setting the alpha level at a different value than 0.05. If we aim to either minimize or balance Type 1 and Type 2 error rates for a given sample size and effect size, the alpha level should be set not based on convention, but by weighting the relative cost of both types of errors.

The second reason is that as the statistical power increases, some *p*-values below 0.05 (e.g., *p* = 0.04) can be more likely when there is *no* effect than when there *is* an effect. This is known as Lindley's paradox [@lindley_statistical_1957; @cousins_jeffreyslindley_2017]. The distribution of *p*-values is a function of the statistical power [@cumming_replication_2008], and the higher the power, the more right-skewed the distribution becomes (i.e. the more low *p*-values are observed). When there is no true effect *p*-values are uniformly distributed, and 1% of observed *p*-values fall between 0.04 and 0.05. When the statistical power is extremely high, not only will most *p*-values fall below 0.05, most will also fall below 0.01. In Figure \ref{fig:p-plot} we see that with high power very low *p*-values are more likely to be observed when there *is* an effect than when there is *no* effect (e.g., the black curve representing *p*-values when the alternative is true falls above the dashed horizontal line for a *p*-value of 0.01). But observing a *p*-value of 0.04 is more likely when the null hypothesis (H0) is true than when the alternative hypothesis (H1) is true and we have very high power (the horizontal dashed line falls above the black curve for *p*-values larger than ~0.025).
 \textcolor{red}{[This plot does not completely correspond to what we do later, as it assumes some (point) effect for the alternative rather than our Unit Information prior. But I guess this does not matter much as it is only to illustrate the general problem?]}

```{r p-plot, fig.width=9, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="*P*-value distributions for a two-sided independent *t*-test with N = 150 and d = 0.5 (black curve) or d = 0 (horizontal dashed line) which illustrates how *p*-values just below 0.05 can be more likely when there is no effect than when there is an effect."}
N <- 150
d <- 0.5
p <- 0.05
p_upper <- 0.05 + 0.00000001
p_lower <- 0.00000001
ymax <- 10 # Maximum value y-scale (only for p-curve)

# Calculations
se <- sqrt(2 / N) # standard error
ncp <- (d * sqrt(N / 2)) # Calculate non-centrality parameter d

# p-value function
pdf2_t <- function(p) 0.5 * dt(qt(p / 2, 2 * N - 2, 0), 2 * N - 2, ncp) / dt(qt(p / 2, 2 * N - 2, 0), 2 * N - 2, 0) + dt(qt(1 - p / 2, 2 * N - 2, 0), 2 * N - 2, ncp) / dt(qt(1 - p / 2, 2 * N - 2, 0), 2 * N - 2, 0)
plot(-10,
  xlab = "P-value", ylab = "", axes = FALSE,
  main = "P-value distribution for d = 0.5 and N = 150", xlim = c(0, .1), ylim = c(0, ymax), cex.lab = 1.5, cex.main = 1.5, cex.sub = 1.5
)
axis(side = 1, at = seq(0, 1, 0.01), labels = seq(0, 1, 0.01), cex.axis = 1.5)
# cord.x <- c(p_lower,seq(p_lower,p_upper,0.001),p_upper)
# cord.y <- c(0,pdf2_t(seq(p_lower, p_upper, 0.001)),0)
# polygon(cord.x,cord.y,col=rgb(0.5, 0.5, 0.5,0.5))
curve(pdf2_t, 0, .1, n = 1000, col = "black", lwd = 3, add = TRUE)
ncp <- (0 * sqrt(N / 2)) # Calculate non-centrality parameter d
curve(pdf2_t, 0, 1, n = 1000, col = "black", lty = 2, lwd = 3, add = TRUE)
abline(v = 0.05, col = "black", lty = 3, lwd = 3)

```

Researchers often want to interpret a significant test result as 'support' for the alternative hypothesis. In other words, in addition to controlling the *error rate*, researchers might be interested in interpreting the *relative evidence* in the data for null hypothesis over the alternative hypothesis. If so, it makes sense to choose the alpha level such that when a significant *p*-value is observed, the *p*-value is actually more likely when the alternative hypothesis is true than when the null hypothesis is true. This means that when statistical power is very high (e.g., the sample size is very large), the alpha level should be reduced. For example, if the alpha level in Figure \ref{fig:p-plot} is lowered to 0.02 then the alternative hypothesis is more likely than the null hypothesis for all significant *p*-values that would be observed. This approach to justifying the alpha level can be seen as a frequentist/Bayesian compromise [@good_bayes-non-bayes_1992]. The error rate is controlled, but the alpha level is also set at a value that guarantees that whenever we reject the null hypothesis, the data is more likely under the alternative hypothesis, than under the null. 

## Minimizing or Balancing Type 1 and Type 2 Error Rates

If both Type 1 as Type 2 errors are costly, then it makes sense to optimally reduce both errors as you design studies. This leads to studies where you make decisions most efficiently. Researchers can choose to design a study with a statistical power and alpha level that minimizes the *combined error rate*. For example, assuming H0 and H1 are a-priori equally probable (the prior probability for both is 0.5). With a Type 1 error rate of 0.05 and statistical power of 0.80 the combined error rate is (0.5×0.05 + 0.5×0.20) = 0.125. We could have chosen to set the alpha level in this study to 0.1. If the Type 1 error rate is 0.1, the statistical power (given the same sample size) would be 0.88, which means the combined error rate is (0.5×0.1 + 0.5×0.12) = 0.11. In other words, increasing the Type 1 error rate from 0.05 to 0.1 reduced the Type 1 error rate from 0.2 to 0.12, and the combined error rate from 0.125 to 0.11. In the latter scenario, our total probability of making an erroneous decision has become 0.015 smaller. As shown below, this approach can be extended to incorporate scenarios where the prior probability of H0 and H1 differ. @mudge_setting_2012 and @kim2021choosing show that by choosing an alpha level based on the relative weight of Type 1 errors and Type 2 errors, and assuming beliefs about the prior probability that H0 and H1 are correct, decisions can be made more efficiently than when the default alpha level of 0.05 is used.

@winer_statistical_1962 writes: "The frequent use of the .05 and .01 levels of significance is a matter of convention having little scientific or logical basis. When the power of tests is likely to be low under these levels of significance, and when Type 1 and Type 2 errors are of approximately equal importance, the .30 and .20 levels of significance may be more appropriate than the .05 and .01 levels." The reasoning here is that a design that has 70% power for the smallest effect size of interest would not balance the Type 1 and Type 2 error rates in a sensible manner. Similarly, in huge datasets it might be possible to achieve very high levels of power for all effect sizes that are still considered meaningful. If such a study has 99% power for effect sizes of interest, and thus a 1% Type 2 error rate, but uses a 5% alpha level, it also suffers from a lack of balance. This latter scenario is quite common in meta-analyses, where researchers by default use a 0.05 alpha level, while the meta-analysis typically have much higher power than 0.95 for all effect sizes of interest. In such cases, it seems sensible to lower the alpha level considerably.

```{r, include=FALSE}
res1 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power")
res1$alpha
res1$beta

res2 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance")
res2$alpha
res2$beta

res1_n_10 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 10, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power")
res1_n_10$alpha
res1_n_10$beta

res1_n_100 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 100, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power")
res1_n_100$alpha
res1_n_100$beta
```

Researchers can decide to either balance Type 1 and Type 2 error rates (e.g., setting both at 5%), or minimize the combined error rate. For any given sample size and effect size of interest there is an alpha level that minimizes the combined error rates. Because the chosen alpha level also influences the statistical power, and the Type 2 error rate is therefore dependent upon the Type 1 error rate, minimizing or balancing error rates requires an iterative procedure. 

As an example, imagine researchers plan to perform a study which will be analyzed with an independent two-sided *t*-test. They plan to collect 50 participants per condition, and set their smallest effect size of interest to Cohen's d = 0.5. They think a Type 1 error is just as costly as a Type 2 error, and believe H0 is just as likely to be true as H1. The combined error rate is minimized when they set alpha to `r format(res1$alpha, digits = 3, nsmall = 2)` (see Figure \ref{fig:weight-plot}, dotted line), which will give the study a Type 2 error rate of beta = `r format(res1$beta, digits = 3, nsmall = 2)` to detect effects of d = 0.5. The combined error rate is `r format((res1$beta + res1$alpha)/2, digits = 3, nsmall = 2)`, while it would have been `r format(((1-pwr::pwr.t.test(d = 0.5, n = 50, sig.level = 0.05, type = 'two.sample', alternative = 'two.sided')$power) + 0.05)/2, digits = 3, nsmall = 2)` if the alpha level was set at 5%^[For the same scenario, balanced error rates are alpha = `r format(res2$alpha, digits = 3, nsmall = 2)` and beta = `r format(res2$beta, digits = 3, nsmall = 2)`.]. 

We see that increasing the alpha level reduced the combined error rate. The reduction in the combined error rate is not huge, but we have reduced the overall probability of making an error. More importantly, we have chosen an alpha level based on a justifiable principle, and clearly articulated the relative costs of a Type 1 and Type 2 error. Perhaps counter-intuitively, decision making is sometimes slightly more efficient after *increasing* the alpha level from the default of 0.05. Had the sample size been much smaller, such as n = 10, the solid line in Figure \ref{fig:weight-plot} shows that the combined error rate will always be high, but it is minimized if we increase the alpha level to alpha to `r format(res1_n_10$alpha, digits = 3, nsmall = 2)`. If the sample size had been n = 100, the optimal alpha level to reduce the combined error rate (still assuming H0 and H1 have equal probabilities, and Type 1 and Type 2 errors are equally costly) is `r format(res1_n_100$alpha, digits = 3, nsmall = 2)` (the long-dashed line in Figure \ref{fig:weight-plot}). 

```{r weight-plot, fig.width=9, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="Weighted combined error rate (y-axis) for an independent *t*-test with n = 10, n = 50, and n = 100 per group and a smallest effect of interest of d = 0.5, for all possible alpha levels (x-axis)."}

resplot1 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 10, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 1, printplot = FALSE)
resplot2 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 1, printplot = FALSE)
resplot3 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 100, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 1, printplot = FALSE)

plot_data <- rbind(resplot1$plot_data, resplot2$plot_data, resplot3$plot_data)
plot_data$n <- as.factor(rep(c(10, 50, 100), each = 9999))

w_c_alpha_plot <- ggplot(data=plot_data, aes(x=alpha_list, y=w_c_list)) +
  geom_line(size = 1.3, aes(linetype = n)) +
  geom_point(aes(x = resplot1$alpha, y = (1 * resplot1$alpha + 1 * (resplot1$beta)) / (1 + 1)), color="red", size = 3) +
  geom_point(aes(x = resplot2$alpha, y = (1 * resplot2$alpha + 1 * (resplot2$beta)) / (1 + 1)), color="red", size = 3) +
  geom_point(aes(x = resplot3$alpha, y = (1 * resplot3$alpha + 1 * (resplot3$beta)) / (1 + 1)), color="red", size = 3) +
  theme_minimal(base_size = 16) +
  scale_x_continuous("alpha", seq(0,1,0.1)) +
  scale_y_continuous("weighted combined error rate", seq(0,1,0.1), limits = c(0,1))
w_c_alpha_plot

```
```{r, include=FALSE}
#Cohen would weigh Type 1 four times as much as Type 2 errors
#We set n to 50 participants and d = 0.5, and costT1T2 to 4.
#We indeed see the recommended alpha is 0.05 and beta is 0.2. 

res3 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 4, printplot = TRUE)
res3$alpha
res3$beta

costT1T2 = 4
priorH1H0 = 1
w_c_3 <- (costT1T2 * res3$alpha + priorH1H0 * res3$beta) / (priorH1H0 + costT1T2)
w_c_3

res4 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 4, printplot = TRUE)
res4$alpha
res4$beta

costT1T2 = 4
priorH1H0 = 1
w_c_4 <- (costT1T2 * res4$alpha + priorH1H0 * res4$beta) / (priorH1H0 + costT1T2)

# If we weigh Type 1 errors 4 times more, we do not just add the two errors # and divide by 2, but we multiple Type 1 errors by 4 and divide by 5.
# We divide by 5 to keep the combined weighed error rate between 0 and 1.
# For example, if both errors are 1, we have (1 * 4 + 1)/5 = 1
# note this ignores differences in priors.
(res4$alpha * 4 + res4$beta)/(5)
# This is equivalent to:
(res4$alpha + res4$beta/4)/(1.25)
# This is just the formula above but filled in and ignoring priors.
# This is the value you see in the curve as weighed combined error rate.

# If the cost of an error is 10000, the total weighed cost is: 
w_c_4 * 10000

( (0.5 * 4 * res4$alpha * 10000) + (0.5 * res4$beta * 10000) ) 

# Replicate res4
a <- res4$alpha
b <- 1 - pwr::pwr.t.test(d = 0.5, n = 50, sig.level = a, type = 'two.sample', alternative = 'two.sided')$power
( (0.5 * 4 * a * 10000) + (0.5 * b * 10000) ) 

# increasing alpha by 0.001 for analysis 4 increases costs 
a <- res4$alpha + 0.001
b <- 1 - pwr::pwr.t.test(d = 0.5, n = 50, sig.level = a, type = 'two.sample', alternative = 'two.sided')$power
( (0.5 * 4 * a * 10000) + (0.5 * b * 10000) ) 

# decreasing alpha by 0.001 for analysis 4 increases costs 
a <- res4$alpha - 0.001
b <- 1 - pwr::pwr.t.test(d = 0.5, n = 50, sig.level = a, type = 'two.sample', alternative = 'two.sided')$power
( (0.5 * 4 * a * 10000) + (0.5 * b * 10000) ) 

# Thus, this is the optimal alpha to minimize costs. 
```

## Weighing the Relative Cost of Errors

Cohen (1988) recommended a study design with a 5% Type 1 error rate and a 20% Type 2 error rate. The reason for this was that instead of weighing both types of errors equally, he felt "Type I errors are of the order of four times as serious as Type II errors". However, some researchers have contracited this proposition, claiming that false negatives might be more severe than false positives [@fiedler2012long].
\textcolor{red}{[Not sure whether this is the best place but I feel we ought the cite this Fiedler paper somewhere in this section]}
The best way to determine the relative costs of Type 1 and Type 2 errors is by performing a cost-benefit analysis. As an example from another discipline, @field_minimizing_2004 quantify the relative costs of Type 1 errors when testing whether native species in Australia are declining. They find that when it comes to the Koala population, given its great economic value, a cost-benefit analysis indicates the alpha level should be set to 1. In other words, one should always act as if the population is declining, because the relative cost of a Type 2 error compared to a Type 1 error is practically infinite. 

Although it can be difficult to formally quantify all factors that determine the costs of Type 1 and Type 2 errors, there is no reason to let the perfect be the enemy of the good. In research questions where there are no direct applications of the research findings, relative costs might be largely subjective, but it is still up to the researcher to determine an appropriate balance between Type 1 and Type 2 errors [@douglas_inductive_2000]. If you have a research strategy where you always follow up on an initial study testing a theoretical prediction with a replication and extension study, and want to innovate, you might want to weigh a Type 2 error more strongly than a Type 1 error. If you are relatively sure policies will be changed based on the outcome of your single study, or believe it will be unlikely that many researchers will have the resources to replicate your study, a Type 1 error rate might be weighed more strongly than a Type 2 error. There are no right or wrong answers, but you need to think through this question when you design a study.

Imagine a researcher plans to collect 50 participants per condition to detect a d = 0.5 effect, but now weighs the cost of Type 1 errors 4 times as much as Type 2 errors. We see that for balanced error rates the Type 1 error rate should be `r format(res3$alpha, digits = 3, nsmall = 2)` and a Type 2 error rate of `r format(res3$beta, digits = 3, nsmall = 2)`. If the researcher had decided to collect 64 participants, we would have been exactly in the scenario Cohen describes, where a 5% Type 1 error rate and 20% Type 2 error rate is recommended, because he personally believed Type 1 errors should be considered 4 times as costly as Type 2 errors. and these balanced error rates are achieved with 64 participants. The larger the sample size, the smaller the error rates, but at any sample size the ratio of Type 1 tot Type 2 errors is 1:4.   

One could also aim to minimize error rates in the latter scenario by setting the Type 1 error rate to `r format(res4$alpha, digits = 3, nsmall = 2)` and the Type 2 error rate to `r format(res4$beta, digits = 3, nsmall = 2)`. Remember the cost of a Type 1 error is four times as large as the cost of a Type 1 error. Imagine a Type 1 error has a cost of 400 and a Type 2 error has a cost of 100. We perform 100 studies, 50 where H0 is true and 50 where H1 is true. We will make `r format(res4$alpha * 50, digits = 3)` Type 1 errors and `r format(res4$beta * 50, digits = 4)` Type 2 errors, with a respective cost of `r format(res4$alpha * 400 * 50, digits = 4)` and `r format(res4$beta * 100 * 50, digits = 4)`, respectively. Figure \ref{fig:cost-plot} visualizes the weighted combined error rate for this study design across the all possible alpha levels. Compare this to the n = 50 line in Figure \ref{fig:weight-plot} to see the impact of the change in the weight of Type 1 compared to Type 2 errors.

```{r cost-plot, fig.width=9, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="Weighted combined error rate (y-axis) for an independent *t*-test with n = 50 per group and a smallest effect of interest of d = 0.5, where Type 1 errors are weighed 4 times as much as Type 2 errors, for all possible alpha levels (x-axis)."}

res4$plot
```

## Incorporating prior probabilities

@miller_quest_2019 explain how the choice for an optimal alpha level depends not just on the relative costs of Type 1 and Type 2 errors, but also on the base rate of true effects. In the extreme case, all studies a researcher designs test true hypotheses. In this case, there is no reason to worry about Type 1 errors, because a Type 1 error can only happen when the null hypothesis is true. Therefore, you can set the alpha level to 1 without any negative consequences. On the other hand, if the base rate of true hypotheses is very low, you are more likely to test a hypothesis where H0 is true, and the Type 1 error rate becomes an important consideration. For example, let's assume a researchers performs 1000 studies, and 100 studies test a hypothesis where H1 is true, and the remaining 900 studies test a hypothesis where H0 is true. With a 5% Type 1 error rate and a 20% Type 2 error rate this researcher will observe 900 × 0.05 = 45 Type 1 errors, and 100 × 0.2 = 20 Type 2 errors. Imagine Type 1 errors are weighed 4 times as much as Type 2 errors (hence our choice for a 5% Type 1 error rate and a 20% Type 2 error rate), so Type 1 errors cost 400 and Type 2 errors cost 100. Because of the fact the H0 is much more often true than H1, the expected cost of Type 1 errors is 45 × 400 = 18000, and the expected cost of Type 2 errors is 20 × 100 = 2000. 

If H0 and H1 had been equally likely (both occur with 50% probability) we should expect to make 500 × 0.05 = 25 Type 1 errors, and 500 × 0.2 = 100 Type 2 errors, and the expected cost of Type 1 errors is 25 × 400 = 10000, and the expected cost of Type 2 errors is 100 × 100 = 10000. Because the prior probabilities of H0 and H1 are not equal, the cost of Type 1 errors is not the same as the cost for Type 2 errors. If possible, researchers can take their expectations about the long run frequency of Type 1 and Type 2 errors into account, so that the expected costs of Type 1 and Type 2 errors are equal. 

```{r, include=FALSE}
res5 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 1, priorH1H0 = 0.1)
res5$alpha
res5$beta

res6 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 1, priorH1H0 = 2, printplot = TRUE)
res6$alpha
res6$beta

costT1T2 = 1
priorH1H0 = 2
w <- (costT1T2 * res6$alpha + priorH1H0 * (res6$beta)) / (priorH1H0 + costT1T2)

```

If you want to balance or minimize error rates in the long run, you should lower the alpha level as the prior probability of a null effect increases, or increase the alpha level as the prior probability of a true effect increases. Because the base rate of true hypotheses is unknown, this step requires a subjective judgment. This can not be avoided, because one always makes assumptions about base rates, even if the assumption is that a hypothesis is equally likely to be true as false (with both H1 and H0 having a 50% probability). Assuming equal prior probabilities for H1 and H0, we saw above that balanced error rates assuming d = 0.5 and collection n = 50 per condition in a *t*-test would imply a Type 1 error rate of `r format(res2$alpha, digits = 3, nsmall = 2)` and a Type 2 error rate of `r format(res2$beta, digits = 3, nsmall = 2)`. If you assume the null hypothesis is 10 times more likely than the alternative hypothesis (or the alternative hypothesis is 0.1 times as likely as the null hypothesis) then balanced error rates would require setting alpha to `r format(res5$alpha, digits = 3, nsmall = 2)` and the Type 2 error rate to `r format(res5$beta, digits = 3, nsmall = 2)`. If you believe the alternative hypothesis is twice as likely to be true as the null hypothesis, balancing error rates in the long run would mean increasing the alpha level and increasing the power by choosing a Type 1 error rate of `r format(res6$alpha, digits = 3, nsmall = 2)` and a Type 2 error rate of `r format(res6$beta, digits = 3, nsmall = 2)`.

The two approaches (balancing error rates or minimizing error rates) typically yield quite similar results. Where minimizing error rates might be slightly more efficient, balancing error rates might be slightly more intuitive (especially when the prior probability of H0 and H1 is equal). Note that although there is always an optimal choice of the alpha level, there is always a range of values that yield quite similar weighted error rates. It is useful to plot weighted error rates as in Figure \ref{fig:cost-plot}. To balance or minimize error rates, researchers need to carefully consider the relative cost of Type 1 and Type 2 errors, the prior probability the null hypothesis is true, and the effect size they want to detect [@mudge_setting_2012], because these factors are used to calculate the weighted combined error rates *w*: 

\begin{equation}
\frac{(cost_{T1T2} \times \alpha + prior_{H1H0} \times \beta)}{prior_{H1H0}+cost_{T1T2}}
\label{eq:minimize}
\end{equation}

For example, imagine Type 1 errors are weighted 4 times as much as Type 2 errors ($cost_{T1T2}$ = 4) and the alternative hypothesis is believed to be 2 times as likely as the null hypothesis ($prior_{H1H0}$ = 10). With alpha = `r format(res6$alpha, digits = 3, nsmall = 2)` and beta = `r format(res6$beta, digits = 3, nsmall = 2)` the weighted combined error rate is `r format(w, digits = 3, nsmall = 2)`.

## Sample Size Justification when Minimizing or Balancing Error Rates

So far we have illustrated how to perform what is known as a *compromise power analysis* where the error rates are computed (in this case, the weighted combined error rate) as a function of the sample size, the effect size, and the desired ratio of Type 1 and Type 2 errors [@erdfelder_gpower_1996]. However, in practice researchers will often want to justify their sample size based on an *a-priori power analysis* where the required sample size is computed to achieve desired error rates, given an effect size of interest [@lakens_sample_2021]. **It is not possible to perform an a-priori power analysis where the combined error rates are minimized (this would just always recommend an infinitely large sample size)**, but it is possible to determine the sample size at which we achieve a certain desired weighted combined error rate. This requires researchers to specify the effect size of interest, and relative cost of Type 1 and Type 2 errors, the prior probabilities of H0 and H1, and the desired weighted combined error rate. 

```{r, include = FALSE}
res7 <- optimal_sample(power_function = "pwr::pwr.t.test(d = 0.5, n = sample_n, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power")

# res8 <- optimal_sample(power_function = "pwr::pwr.t.test(d = 0.5, n = i, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", errorgoal = 0.05, error = "minimal", costT1T2 = 1, priorH1H0 = 0.1)
# 
# restest <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 65, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 1, priorH1H0 = 0.1)
# 
#  restest2 <- optimal_sample(power_function = "pwr::pwr.t.test(d = 0.5, n = i, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", errorgoal = 0.05, error = "balance", costT1T2 = 1, priorH1H0 = 1)

# $alpha
# [1] 0.02704774
# 
# $beta
# [1] 0.2701555
# 
# $errorrate
# [1] 0.04914845
# So Type 1 errors are 10 times more likely than Type 2 errors (priorH1H0 = 0.1)
# We should expect 0.027 × 1000 = 27 Type 1 errors and 0.27 × 100 = 27. 
# Thus, error rates are balanced. But the weighted error rate is not 0.05, but 0.027. So something is wrong. 
 #(27+27)/1100
 #

```

Imagine a researcher is interested in detecting an effect of Cohen's d = 0.5 with a two sample *t*-test. The researcher believes Type 1 errors are equally costly as Type 2 errors, and believes a H0 is equally likely to be true as H1. They desire a weighted combined error rate of 5%. We can optimize the weighted combined error rate as a function of the alpha level and sample size through an iterative procedure, that reveals a sample size of `r res7$samplesize` participants in each independent group is required to achieve the desired weighted combined error rate. This sample size can also be computed directly with common power analysis software by entering the desired alpha level and statistical power directly. In this example, where Type 1 and Type 2 error rates are weighted equally, and the prior probability of H0 and H1 is assumed to be 0.5, the sample size is identical that required to achieve an alpha of 0.05 and a desired statistical power for d = 0.5 of 0.95.  \textcolor{red}{[MAX, I think the figure is confusing - let's discuss. Also, the optimize function should go to n+1 (it now does not match gpower always, it can optimize the below the required error rate (e.g., 0.0491 but should go to the next sample size)). Also, the function does not seem to work if I change defaults (see code above)]}. 

```{r, include=FALSE}
# alphas <- c()
# betas <-c()
# Error <-c()
# 
# power_function = "pwr::pwr.t.test(d = 0.5, n = i, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power"
# for (i in 10:150) {
# res <- optimal_alpha(power_function = paste(stringr::str_replace(power_function, "n = i", paste("n  =", i))), costT1T2 = 4)
# alphas <- c(alphas, res$alpha)
# betas <- c(betas, res$beta)
# Error <- c(Error, res$errorrate)
# }
# 
# data <- as.data.frame(cbind(alphas, betas, Error))
# write.csv(data, "plotdata.csv")
```


```{r, include = FALSE}
data <- read.csv("plotdata.csv")
samplesize <- 10:150
line <- rep(0.05, length(samplesize))
data <- as.data.frame(cbind(samplesize,line, data))

colors <- c("Beta" = "grey", "Weighted Combined Error Rate of 5%" = "red", "Weighted Combined Error Rate" = "black", "Alpha" = "grey")
linetypes <- c("Beta" = "dotted", "Weighted Combined Error Rate of 5%" = "solid", "Weighted Combined Error Rate" = "solid", "Alpha" = "dashed")

library(ggplot2)
plot <- ggplot(aes(x=samplesize), data=data) +
    geom_line(size = 1.3, aes(y = Error, color = "Weighted Combined Error Rate", linetype = "Weighted Combined Error Rate")) +
    theme_minimal(base_size = 18) +
    scale_x_continuous("Sample Size", seq(10,150,20)) +
    scale_y_continuous("",seq(0,1,0.05), limits = c(0,0.5)) + 
    geom_line(aes(y=alphas,  color = "Alpha", linetype = "Alpha"), data=data, size = 1.3) + 
    geom_line(aes(y=betas,  color = "Beta", linetype = "Beta"), data=data, size = 1.3) +  
    geom_point(aes(x = data$samplesize[data$Error == max(data$Error[data$Error < 0.05])], y = 0.05, color = "Weighted Combined Error Rate of 5%", linetype = "Weighted Combined Error Rate of 5%"), size = 3) +
        labs(x = "Sample Size",
         y = "",
         color = "",
         linetype = "") +
    scale_color_manual(values = colors) +
    scale_linetype_manual(values = linetypes) + 
  theme(legend.position="bottom")

plot <- plot +   geom_segment(aes(x = data$samplesize[data$Error == max(data$Error[data$Error < 0.05])], xend= data$samplesize[data$Error == max(data$Error[data$Error < 0.05])], y = 0.05, yend = -Inf), color = "red", linetype = "dotted")
  
```

```{r error-plot, fig.width=10, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="Weighted combined error rate, alpha, and beta for an independent *t*-test as a function of sample size when the alpha level is justified to minimize the error rate at each sample size. The sample size corresponding to the red dot is the minum required sample size to achieve 5% weighted combined error"}

plot
```

## Lowering the Alpha Level as a Function of the Sample Size

Formally controlling the costs of errors can be a challenge, as it requires researchers to specify relative costs of Type 1 and Type 2 errors, prior probabilities, and the effect size of interest. Due to this complexity, researchers might be tempted to fall back to the heuristic use of an alpha level of 0.05. Fisher [-@fisher_design_1971] referred to the default alpha level of 0.05 as a “convenient convention”, and it might suffice as a threshold to make scientific claims in a scientific system where we have limited resources and value independent replications [@tunc_epistemic_2021]. 

However, there is a well known limitation of using a fixed alpha level that has lead statisticians to recommend choosing an alpha level as a function of the sample size. To understand the argument behind this recommendation, it is important to distinguish between statistical inferences based on error control and inferences based on likelihoods. An alpha level of 5% will limit incorrect decisions to a desired maximum (in the long run, and when all test assumptions are met). However, from a likelihood perspective it is possible that the observed data is much more likely when the null hypothesis is true than when the alternative hypothesis is true, even when the observed *p*-value is smaller than 0.05. This situation, known as Lindley's paradox, is visualized in Figure \ref{fig:p-plot}. It emerges because in frequentist statistics the critical value of a test approaches a limit as the sample size increases (e.g., *t* = 1.96 for a two-sided *t*-test with an alpha level of 0.05). In Bayesian statistics a critical value (e.g., a BF > 10) requires a larger test statistic as the sample size increases (see @rouder_bayesian_2009 and @zellner_introduction_1971). 

To prevent situations where a frequentist rejects the null hypothesis based on p < 0.05, when the evidence in the test favors the null hypothesis over the alternative hypothesis (e.g., BF < 1) it is recommended to lower the alpha level as a function of the sample size. The need to do so is discussed extensively by @leamer_specification_1978. He writes "The rule of thumb quite popular now, that is, setting the significance level arbitrarily to .05, is shown to be deficient in the sense that from every reasonable viewpoint the significance level should be a decreasing function of sample size." This was already recognized by @jeffreys_theory_1939, who discusses ways to set the alpha level in the Neyman-Pearson approach to statistics: "We should therefore get the best result, with any distribution of alpha, by some form that makes the ratio of the critical value to the standard error increase with n. It appears then that whatever the distribution may be, the use of a fixed *P* limit cannot be the one that will make the smallest number of mistakes." Similarly, @good_bayes-non-bayes_1992 notes: "we have empirical evidence that sensible *P* values are related to weights of evidence and, therefore, that *P* values are not entirely without merit. The real objection to *P* values is not that they usually are utter nonsense, but rather that they can be highly misleading, especially if the value of N is not also taken into account and is large."

To prevent Lindley's paradox when using frequentist statistics one would need to adjust the alpha level in a way that the likelihood ratio (also called the Bayes factor) at the critical test statistic is not larger than 1. With such an alpha level, a significant *p*-value will always be at least as likely if the alternative is true than if the null is true, which avoids Lindley's paradox. @faulkenberry2019estimating and @rouder2009bayesian developed Bayes factors for *t*-tests and ANOVAs which can calculate the Bayes factor from the test statistic and degrees of freedom. We developed a shiny app (link) that lowers the alpha level where necessary, such that the critical value that leads researchers to reject H0 is also high enough to guarantee that the data provide evidence in favor of H1. 

There are two relatively arbitrary decisions that can be made about how to prevent Lindley's paradox, and @leamer_specification_1978 and @good_bayes-non-bayes_1992 offer their own approaches. In our calculations we rely on a unit information prior for the anova and a Cauchy prior for *t*-tests. Both of these priors are relatively wide which sometimes results in overstated evidence for H0, which means it is a conservative choice when attempting to prevent Lindley's paradox. This choice of this prior is itself a 'convenient convention', but researchers can lower the alpha level based on a more informed prior using the same logic by writing custom code. A benefit of the default use of the unit information prior is that, in contrast to previous approaches that aimed to calculate a Bayes factor for every *p*-value [e.g., @colquhoun2019false; @colquhoun2017reproducibility] researchers do not need to specify the effect size under the alternative hypothesis. This lowers the barrier to adopting this approach in situations where it is difficult to specify a smallest effect size of interest or an expected effect size. 

A second decision is the threshold of the Bayes factor used to lower the alpha level. Using a Bayes factor of 1 formally prevents Lindley's paradox, but this means it is in theory still possible to reject the null hypothesis when the data provide just as much evidence for H1 as for H0. Although it is important to note that researchers will often observe *p*-values well below the critical value, and thus, in practice the evidence in the data will be substantially in favor of H1 when H0 is rejected, researchers might want to increase the threshold of the Bayes factor that is used to lower the alpha level to prevent weak evidence [@Jeffreys1939] by setting the threshold to a larger value (e.g., BF > 3). Therefore, we extended the shiny app to allow researchers to adjust the alpha level in a way that a significant *p*-value will always provide moderate or strong evidence against the null hypothesis.  

We can illustrate the approach to lowering the alpha level as a function of the sample size based on a study in Daryl Bem's infamous paper where he made the questionable claim that precognition is real [@bem2011feeling]. In study six of his paper, Bem reports the following one sample *t*-tests $t$(149) = 1.80, $p$ = .037, $d$ = 0.15, and $t$(149) = -1.77, $p$ = .039, $d$ = 0.14, as evidence for "retroactive habituation". It seems like the $p$-values in this study are remarkably close to the 5% threshold, especially given the sample size of 150 participants. Therefore, let us consider which alpha level Bem would have needed to use to avoid Lindley's Paradox, and to achieve moderate or strong evidence. Figure \ref{BFBem} shows the relationship of two-sided *p*-values and Bayes factors using a Cauchy prior with default scale 0.707 given Bem's sample size of 150 for a within subjects $t$-test. 


```{r,echo = FALSE, message = FALSE, warning = FALSE, include = FALSE }

n1 <- 150

loops <- seq(from = 0, to = 7, by = 0.001)
p <- numeric(length(loops))
bf <- numeric(length(loops))
#d <- numeric(length(loops))
tval <- numeric(length(loops))
i <- 0

for(t in loops){
  i <- i+1
  bf[i] <- exp(BayesFactor::ttest.tstat(t, n1, rscale = 0.707, nullInterval = c(0, Inf))$bf)
  p[i] <- pt(t, ((n1) - 1), lower=FALSE)
  tval[i] <- t
  #d[i] <- t * sqrt((1/n1)+(1/n2))
}
```


```{r,echo = FALSE, message = FALSE, warning = FALSE, include = FALSE }
lindley  <- ttestEvidence(1,  150, one.sided = TRUE, rscale = 0.707)
moderate <- ttestEvidence(3,  150, one.sided = TRUE, rscale = 0.707)
strong   <- ttestEvidence(10, 150, one.sided = TRUE, rscale = 0.707)

```


```{r BFBem, fig.width=7, fig.height=7, fig.cap = "Relationship beteween p-value and Bayes factor for a one sample t-test with 150 participants as in Bem(2011) and using a Cauchy prior."}

plot(p, bf, type="l", lty=1, lwd=3, xlim = c(0, 0.05), ylim = c(0, 10), axes = F, xlab = "p-value", ylab = "Bayes factor")
axis(side=1, at = c(0, as.numeric(lindley), as.numeric(moderate), as.numeric(strong), 0.05), labels = c(0, round(lindley, digits = 3), round(moderate, digits = 3), round(strong, digits = 3), 0.05),  lwd = 3, las = 3)
axis(side=2, at = c(0.33, 1, 3, 10), labels = c("1/3", 1, 3, 10), lwd = 3)

abline(h = c(1, 3, 10), col = "gray", lty = 2)
abline(v = c(lindley, moderate, strong), lty = 3)

```


To avoid Lindley's paradox, Bem would need to use an alpha level of `r printnum(lindley, digits = 4)` for a one sided-test. In other words, the observed *p*-values are more likely under the null hypothesis than under the alternative. 
However, it seems desirable to require at least moderate evidence for the alternative before claiming a discovery. To achieve this Bem would have needed to use a alpha level of `r printnum(moderate, digits = 4)`. To provide strong evidence given a significant *p*-value, he would have needed to use an even lower alpha level of `r printnum(strong, digits = 4)`. We can see from this example, that *p* = 0.05 is too low of an evidential standard under large sample sizes.

For small sample sizes it is possible to guarantee that a significant result is evidence for the alternative hypothesis using a higher alpha level than 0.05. For example, for an independent *t*-test this is achieved whenever the sample size is smaller than 84 based on a Bayes factor threshold of 1. It is not recommended to use this procedure to increase the sample size above a conventional choice of an alpha level (e.g., 0.05). This approach to the justification of an alpha level assumes researchers foremost want to control the error rate, and secondary prefer to prevent Lindley's paradox by reducing the alpha level as a function of the sample size where needed. Figure \ref{fig:lindley} shows the alpha levels for different values of N for betweeen and within subjects $t$-test using the Cauchy or the unit information prior. We can see that particularly for within subjects $t$-tests the alpha level rapidly falls below 5% as the sample size increases, while the choice of prior (Cauchy vs Unit Information) is only mildly consequential. 

```{r, include = FALSE}
# samplesize    <- seq(30, 300, 2)
# cauchywithin  <- c()
# cauchybetween <- c()
# unitwithin    <- c()
# unitbetween   <- c()
#
# for (i in samplesize){
#   cauchywithin   <- c(cauchywithin,     ttestEvidence(1, i))
#   unitwithin     <- c(unitwithin,       ttestEvidence(1, i, Cauchy = F))
#   cauchybetween  <- c(cauchybetween,    ttestEvidence(1, i/2, i/2))
#   unitbetween    <- c(unitbetween,       ttestEvidence(1, i/2, i/2, Cauchy = F))
# }
#
# data <- as.data.frame(cbind(samplesize, cauchywithin, cauchybetween, unitwithin, unitbetween))
# write.csv(data, "plotlindleydata.csv")
```

```{r, include = FALSE}
data <- read.csv("plotlindleydata.csv")



colors <- c("Cauchy" = "grey", "Unit Information" = "black")
linetypes <- c("within-sample" = "dotted", "between-sample" = "solid")


library(ggplot2)
plot <- ggplot(aes(x=samplesize), data=data) +
    geom_line(size = 1.3, aes(y = cauchywithin, color = "Cauchy", linetype = "within-sample")) +
    geom_line(size = 1.3, aes(y = cauchybetween, color = "Cauchy", linetype = "between-sample")) +
    geom_line(size = 1.3, aes(y = unitwithin, color = "Unit Information", linetype = "within-sample")) +
    geom_line(size = 1.3, aes(y = unitbetween, color = "Unit Information", linetype = "between-sample")) +
    theme_minimal(base_size = 18) +
    scale_x_continuous("Total Sample Size (N)", seq(10,300,20)) +
        labs(x = "Sample Size",
         y = "",
         color = "",
         linetype = "") +
    scale_color_manual(values = colors) +
    scale_linetype_manual(values = linetypes) + 
  theme(legend.position="bottom")

    
```

```{r lindley, fig.width=10, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="Optimal alpha Level for within and between-sample $t$-tests for Cauchy and Unit Information Prior \textcolor{red}{[Interesting that it switches with respect to which results in a lower alpha level.I will need to update this plot if we don't use unit information anymore. But we could then compare on sided and two sided]}"}
plot
```

<!-- Figure \ref{fig:heatmap} shows which alpha level is larger as a function of sample size (per group) and expected effect size for a two-sample *t*-test. For green values minimizing error rates resulted in higher alpha values, whereas red areas mean that avoiding the Lindley paradox resulted in higher alpha levels. We can see that when the expected effect size increases (x-axis) the alpha level will be smaller when using the method that minimizes error rates. This is mostly a result of how we set up the likelihood ratio calculations. Due to the unit information prior the method trying to avoid the Lindley paradox is not sensitive to the expected effect size. If the sample size increases on the other hand (y-axis) the alpha level reduces faster when avoiding the Lindley paradox then when minimizing error rates.  -->

<!-- \textcolor{red}{[MAX, this is an insightful plot, but, it makes more sense to show the alpha levels (say, a contour plot with lines for alpha 0.01, 0.02, 0.03, 0.04, 0.05). Also, we do not really require them to choose between these 2. I guess the 2 approaches really are fundamentally different philosophies - so the choice is not dependent on the alpha anyway?]}.  -->


```{r, include = FALSE}
# alphalogodds <- c()
# ds <- c()
# samples <- c()
# power_function <- "pwr::pwr.t.test(d = x, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power"
# power_function_d <- ""
# for (d in seq(0.2,1, 0.025)) {
#   power_function_d = paste(stringr::str_replace(power_function, "d = x", paste("d  =", d)))
#   for (sample in seq(10, 300, 10)) {
#     alpha1 <- optimal_alpha(power_function = paste(stringr::str_replace(power_function_d, "n = i", paste("n  =", i))))$alpha
#     alpha2 <- ttestEvidence("lindley", sample, sample)
#     alphalogodds <- c(alphalogodds, log(alpha1/alpha2))
#     ds <- c(ds, d)
#     samples <- c(samples, sample)
#     }
#   }
# 
# library(tidyr)
# plotd <- as.data.frame(cbind( samples, ds, alphalogodds))
# write.csv(plotd, "plotdata2.csv")
```

```{r heatmap, fig.width=6, fig.height=5, echo=FALSE, message=FALSE, warning=FALSE, results='hide', fig.cap="Heatmap of log(alpha_minimize/alpha_lindley) as a function of sample size and expected effect size."}

# plotd <- read.csv("plotdata2.csv")
# ggplot(plotd, aes(ds, samples)) +
#   geom_tile(aes(fill = alphalogodds)) + 
#   scale_fill_gradient(low = "red", high = "green") + 
#   theme_minimal() +
#   scale_x_continuous(expand = c(0,0)) + 
#   scale_y_continuous(expand = c(0,0), breaks = c(seq(0,300, 20))) + 
#         labs(x = "Cohen's d",
#          y = "Sample Size",
#          fill = "")
```

# Discussion

Editors and reviewers should *always* ask authors to justify their choice of error rates, whenever researchers use data to make decisions about the presence or absence of an effect. As @skipper_sacredness_1967 remarks: "If, in contrast with present policy, it were conventional that editorial readers for professional journals routinely asked: "What justification is there for this level of significance? authors might be less likely to indiscriminately select an alpha level from the field of popular eligibles." In a Neyman-Pearson approach to statistics, the alpha level should be set before the data is collected. When reviewers of for example a Registered Report would ask authors to justify their alpha level, it would be convenient if they can recommend some approaches to do so. The current manuscript hopefully helps to fill this gap. 
When should we minimize or balance error rates and when should we avoid Lindley's paradox? In practice, it might be most convenient to minimize or balance error rates whenever there is enough information to conduct a power analysis, and if researchers feel comfortable specifying the relative cost of Type 1 and Type 2 errors, and the priori probabilities of the null and alternative hypothesis. If researchers do not feel they can specify these parameters, they can fall back on the approach to lower the alpha level as a function of the sample size to prevent Lindley's paradox. The first approach is most attractive to researchers who follow a strict Neyman-Pearson approach, while researchers interested in a compromise between frequentist and Bayesian inference might be drawn more strongly towards the second approach @good_bayes-non-bayes_1992. 

A Shiny app is available that allows users to perform the calculations recommended in this article. It can be used to minimize or balance alpha and beta, which works by specifying the effect size of interest and the sample size, as well as an analytic power calculation. The effect size should be determined as in a normal a-priori power analysis (preferably based on the smallest effect size of interest, for recommendations, see @albers_when_2018). Alternatively, researchers lower the alpha level as a function of the sample size by specifying only their sample size. Whichever approach is used, it is strongly recommended to preregister the alpha level that researchers plan to use before the data is collected.

Note that throughout this manuscript we have reported error rates rounded to three decimal places. Although we can compute error rates to many decimals, it is useful to remember that the error rate is a long run frequency, and in any finite number of tests (e.g., all the tests you will perform in your lifetime) the observed error rate vary somewhere around the long run error rate. Different approaches (e.g., using a Cauchy prior or a unit information prior when lowering the alpha to prevent Lindley's paradox) might yield very similar error rates. The differences between the alpha levels that will be used might not be meaningful when controlling error rates in practice, but they differ in the rationale behind the justification of the error rates, and we recommend preregister alpha levels up to three decimals, while keeping in mind there is some false precision in error rates with too many decimals.  

Because of the strong overreliance on a 5% error rate when designing studies, we have seen relatively few people attempt to justify their alpha level. As researchers start to justify their alpha, we will hopefully see the development of good examples and best practices for psychological science. It might be a challenge to get started, but the two approaches presented in the current article are one way to move away from the mindless use of a 5% alpha level. There is a lot to gain, and justifying alpha levels should improve our statistical inferences and increase the efficiency of the research we perform.

# References

\begingroup
\interlinepenalty = 10000 
<div id="refs" custom-style="Bibliography"></div>
\endgroup


```{r, include = FALSE}
# # Test has alpha and beta of 5%
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 1, priorH1H0 = 1)
# res$alpha
# res$beta
# 
# # Test if T1 errors are weighed 10 times more than Type 1 errors:
# # In the long run we will make 10 times as few Type 1 errors as type 2 errors.
# # But the total cost of the errors will be equal in the long run. 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 10, priorH1H0 = 1)
# res$alpha
# res$beta
# 
# # If we think Type 1 errors are 10 times as likely to happen as Type 2 errors:
# # We reduce the alpha level by 10. In the long run we will make as many Type 1 as Type 2 errors (if our prior is correct)
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 1, priorH1H0 = .1)
# res$alpha
# res$beta
# 
# # If we think Type 1 errors are 10 times as likely to happen as Type 2 errors, and we think Type 1 errors cost 10 times as much:
# # We reduce the alpha level by 100. In the long run we will make 10 times less Type 1 as Type 2 errors (if our prior is correct), but since we weight these 10 times more, the final cost will be equal. 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 10, priorH1H0 = .1)
# res$alpha
# res$beta
# 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "balance", costT1T2 = 4, priorH1H0 = 4)
# res$alpha
# res$beta
# 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 105, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 4, priorH1H0 = 4)
# res$alpha
# res$beta
# 
# # Explain weights
# costT1T2 <- 1
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = costT1T2, priorH1H0 = 1)
# res$alpha
# res$beta
# 
# costT1T2 <- 1
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 1, n = 30, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = costT1T2, priorH1H0 = 1)
# res$alpha
# res$beta
# 
# 
# #ANOVA example
# #
# res4 <- optimal_alpha(power_function = "pwr::pwr.anova.test(n = 30, k = 3, f = 0.5285, sig.level = x)$power", error = "minimal", costT1T2 = 1)
# res4$alpha
# res4$beta
# 
# w <- (res4$alpha + res4$beta) / 2
# w
# 
# w_c <- (4*res4$alpha + res4$beta) / 5
# w_c
# 
# cost <- 0.25
# w_s <- (0.05 + (1 - pwr::pwr.anova.test(n = 30, k = 3, f = 0.5542, sig.level = 0.05)$power)) / 2
# w_s
# w_s_c <- (cost * 0.05 + (1 - pwr::pwr.anova.test(n = 30, k = 3, f = 0.5542, sig.level = 0.05)$power)) / (1 + cost)
# w_s_c
# 
# (costT1T2 * res$alpha + res$beta) / (1 + costT1T2)
# 
# # Create plots
# 
# costT1T2 <- 0.3
# priorH1H0 <- 7
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = costT1T2, priorH1H0 = priorH1H0)
# res$alpha
# res$beta
# 
# alpha_level <- 0
# alpha_list <- numeric(9999)
# beta_list <- numeric(9999)
# w_list <- numeric(9999)
# w_c_list <- numeric(9999)
# for(i in 1:9999) {
#   alpha_level <- alpha_level + 0.0001
#   alpha_list[i] <- alpha_level
#   beta_list[i] <- 1 - pwr::pwr.t.test(d = 0.5, n = 50, sig.level = alpha_level, type = 'two.sample', alternative = 'two.sided')$power
#   w_list[i] <- (alpha_level + beta_list[i]) / 2
#   w_c_list[i] <- (costT1T2 * alpha_level + priorH1H0 * beta_list[i]) / (costT1T2 + priorH1H0)
# }
# 
# # Create dataframe for plotting
# dat <- data.frame(alpha_list, beta_list, w_list, w_c_list)
# 
# ggplot(data=dat, aes(x=alpha_list, y=beta_list)) +
#   geom_line() +
#   theme_minimal() +
#   scale_x_continuous("alpha", seq(0,1,0.1)) + 
#   scale_y_continuous("beta", seq(0,1,0.1))
# 
# ggplot(data=dat, aes(x=alpha_list, y=w_list)) +
#   geom_line() +
#   theme_minimal() +
#   scale_x_continuous("alpha", seq(0,1,0.1)) + 
#   scale_y_continuous("cost", seq(0,1,0.1), limits = c(0,1))
# 
# ggplot(data=dat, aes(x=alpha_list, y=w_c_list)) +
#   geom_line() +
#   geom_point(aes(x = res$alpha, y = (costT1T2 * res$alpha + priorH1H0 * res$beta) / (priorH1H0 + costT1T2)), color="red") +
#   theme_minimal() + 
#   scale_x_continuous("alpha", seq(0,1,0.1)) + 
#   scale_y_continuous("weighted combined error rate", seq(0,1,0.1), limits = c(0,1))
# 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = costT1T2, priorH1H0 = priorH1H0)
# 
# res <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power", error = "minimal", costT1T2 = 2, priorH1H0 = 4, printplot = TRUE)
# 
# 
# min(dat$w_c_list)
# 
# res1 <- optimal_alpha(power_function = "pwr::pwr.t.test(d = 0.5, n = 50, sig.level = x, type = 'two.sample', alternative = 'two.sided')$power")
# res1$alpha
# res1$beta


```
